[file name]: publicarme.html
[file content begin]
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WORKLY - Publicar Talento Humano</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 0;
        }
        
        /* Bot√≥n de volver en esquina superior izquierda */
        .back-button-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
        }
        
        .back-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            color: #2c3e50;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        
        /* Contenedor principal expandido */
        .main-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            width: 100%;
        }
        
        .publish-container {
            width: 95%;
            max-width: 1200px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 80vh;
        }
        
        .publish-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        
        .publish-header h1 {
            font-size: 32px;
            font-weight: 700;
            margin: 0 0 10px 0;
        }
        
        .publish-header p {
            font-size: 18px;
            opacity: 0.9;
            margin: 0;
        }
        
        .content-wrapper {
            display: flex;
            flex: 1;
        }
        
        .form-section {
            flex: 1;
            padding: 40px;
        }
        
        .info-section {
            flex: 0 0 400px;
            background: #f8f9fa;
            padding: 40px;
            border-left: 1px solid #eaeaea;
        }
        
        .form-group {
            margin-bottom: 30px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #eaeaea;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            background: white;
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #eaeaea, transparent);
            margin: 35px 0;
        }
        
        .publish-btn {
            display: block;
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .publish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .publish-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .info-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #3498db;
        }
        
        .info-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-card p {
            color: #5a6c7d;
            line-height: 1.6;
            margin: 0;
        }
        
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 25px;
            margin-top: auto;
        }
        
        .footer p {
            margin: 0;
            color: #bdc3c7;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        /* Estilos para el tipo de usuario detectado */
        .user-type-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        /* Estilos para la informaci√≥n de membres√≠a */
        .membership-status {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
        
        .membership-status.warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left-color: #ffc107;
        }
        
        .membership-status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-left-color: #dc3545;
        }
        
        .membership-status.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left-color: #28a745;
        }
        
        .publications-counter {
            font-size: 14px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .upgrade-prompt {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
            text-align: center;
        }
        
        .upgrade-btn {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }
        
        @media (max-width: 992px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .info-section {
                flex: none;
                border-left: none;
                border-top: 1px solid #eaeaea;
            }
            
            .publish-header {
                padding: 30px 20px;
            }
            
            .form-section, .info-section {
                padding: 30px;
            }
        }
        
        @media (max-width: 768px) {
            .publish-container {
                width: 100%;
                border-radius: 0;
                min-height: 100vh;
            }
            
            .main-container {
                padding: 0;
            }
            
            .back-button-container {
                top: 15px;
                left: 15px;
            }
            
            .back-button {
                padding: 10px 15px;
                font-size: 14px;
            }

            .user-type-badge {
                top: 15px;
                right: 15px;
                font-size: 12px;
                padding: 6px 12px;
            }
        }
        
        @media (max-width: 480px) {
            .form-section, .info-section {
                padding: 20px;
            }
            
            .publish-header {
                padding: 25px 15px;
            }
            
            .publish-header h1 {
                font-size: 26px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="text-center">
            <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Cargando informaci√≥n...</span>
            </div>
            <h5>Cargando informaci√≥n del usuario...</h5>
            <p class="text-muted">Por favor espera mientras obtenemos tus datos</p>
        </div>
    </div>

    <!-- Bot√≥n de volver en esquina superior izquierda -->
    <div class="back-button-container">
        <button class="back-button" onclick="goBack()">
            <span>‚Üê</span> Volver
        </button>
    </div>

    <!-- Contenedor principal -->
    <div class="main-container">
        <div class="publish-container">
            <div class="publish-header">
                <h1 id="pageTitle">Publicar talento humano</h1>
                <p id="pageSubtitle">Comparte tu talento con nuestra comunidad WORKLY</p>
                <!-- Badge para mostrar el tipo de usuario detectado -->
                <div id="userTypeBadge" class="user-type-badge" style="display: none;"></div>
            </div>
            
            <div class="content-wrapper">
                <div class="form-section">
                    <!-- Formulario para Talento Humano -->
                    <form id="talentForm">
                        <!-- Campo oculto para el ID del usuario -->
                        <input type="hidden" id="userId" value="">
                        <!-- Campo oculto para el tipo de usuario -->
                        <input type="hidden" id="userType" value="">
                        <!-- Campo oculto para el tipo de membres√≠a del usuario -->
                        <input type="hidden" id="tipoMembresiaVinculada" value="">
                        
                        <!-- Estado de membres√≠a y publicaciones -->
                        <div id="membershipStatusContainer"></div>
                        
                        <div class="form-group">
                            <label for="nombre" class="form-label">Nombre</label>
                            <input type="text" id="nombre" class="form-control" placeholder="Ingresa tu Nombre completo">
                        </div>
                        
                        <div class="form-group">
                            <label for="titulo_publicidad" class="form-label">T√≠tulo de la publicaci√≥n</label>
                            <input type="text" id="titulo_publicidad" class="form-control" placeholder="Ingresa un t√≠tulo atractivo para tu publicaci√≥n">
                        </div>
                        
                        <div class="form-group">
                            <label for="categoria" class="form-label">Categor√≠a</label>
                            <select id="categoria" class="form-control">
                                <option value="" disabled selected>Cargando categor√≠as...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="horario_disponible" class="form-label">Horario disponible</label>
                            <input type="text" id="horario_disponible" class="form-control" placeholder="Ej: Lunes a Viernes 8:00-18:00, S√°bados 9:00-13:00">
                        </div>
                        
                        <div class="form-group">
                            <label for="fecha_publicacion" class="form-label">Fecha de publicaci√≥n</label>
                            <input type="date" id="fecha_publicacion" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="contacto" class="form-label">Contacto</label>
                            <input type="text" id="contacto" class="form-control" placeholder="Num. de contacto">
                        </div>
                        
                        <div class="form-group">
                            <label for="ubicacion" class="form-label">Ubicaci√≥n</label>
                            <input type="text" id="ubicacion" class="form-control" placeholder="Ciudad o zona donde trabajas">
                        </div>
                        
                        <div class="form-group">
                            <label for="descripcion" class="form-label">Descripci√≥n</label>
                            <textarea id="descripcion" class="form-control form-textarea" placeholder="Describe tus habilidades, experiencia y servicios que ofreces..."></textarea>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <button type="button" class="publish-btn" id="publishButton" onclick="submitTalentForm()">Publicar</button>
                    </form>
                </div>
                
                <div class="info-section">
                    <div class="info-card">
                        <h3>üí° Consejos para Publicar</h3>
                        <p>‚Ä¢ Completa todos los campos obligatorios</p>
                        <p>‚Ä¢ S√© espec√≠fico en tu descripci√≥n</p>
                        <p>‚Ä¢ Incluye informaci√≥n de contacto v√°lida</p>
                        <p>‚Ä¢ Selecciona la categor√≠a m√°s adecuada</p>
                    </div>
                    
                    <div class="info-card">
                        <h3>üöÄ Beneficios WORKLY</h3>
                        <p>‚Ä¢ Alcance a miles de clientes potenciales</p>
                        <p>‚Ä¢ Perfil profesional destacado</p>
                        <p>‚Ä¢ Sistema de rese√±as y calificaciones</p>
                        <p>‚Ä¢ Soporte y asistencia continua</p>
                    </div>
                    
                    <div class="info-card">
                        <h3>üìã L√≠mites por Membres√≠a</h3>
                        <div id="membershipLimitsInfo">
                            <p><strong>B√°sica:</strong> 3 publicaciones activas</p>
                            <p><strong>Est√°ndar:</strong> 10 publicaciones activas</p>
                            <p><strong>Premium:</strong> Publicaciones ilimitadas</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>üöÄ WORKLY - Tu plataforma de confianza para servicios profesionales</p>
        <p>&copy; 2024 WORKLY. Todos los derechos reservados.</p>
    </div>

    <script>
        const BACKEND_URL = 'http://127.0.0.1:8001';
        let userData = null;
        let userPublications = [];
        let currentMembership = null;
        let currentPublicationsCount = 0;
        let userId = null;
        let categoriasData = []; // Variable para almacenar las categor√≠as reales

        // L√≠mites de publicaciones por tipo de membres√≠a
        const MEMBERSHIP_LIMITS = {
            'visitante': 0,
            'basica': 3,
            'b√°sica': 3,
            'estandar': 10,
            'est√°ndar': 10,
            'standard': 10,
            'premium': 999,
            'empresa': 999,
            'enterprise': 999
        };

        // Mapeo de nombres de membres√≠a para normalizaci√≥n
        const MEMBERSHIP_NAME_MAP = {
            'basica': 'b√°sica',
            'standard': 'est√°ndar', 
            'estandar': 'est√°ndar',
            'premium': 'premium',
            'empresa': 'empresa',
            'enterprise': 'empresa',
            'visitante': 'visitante'
        };

        // Mapeo de membres√≠as a valores num√©ricos para el backend
        const MEMBERSHIP_VALUES = {
            'b√°sica': 1,
            'est√°ndar': 2,
            'premium': 3,
            'empresa': 3
        };

        // Verificar autenticaci√≥n y cargar datos del usuario al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', async function() {
            await checkAuthenticationAndLoadUserData();
        });

        // Verificar autenticaci√≥n y cargar datos del usuario
        async function checkAuthenticationAndLoadUserData() {
            const token = localStorage.getItem('access_token');
            
            if (!token) {
                redirectToLogin();
                return;
            }

            showLoading(true);

            try {
                // Obtener datos del perfil del usuario
                const response = await fetch(`${BACKEND_URL}/auth/user-profile/`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const responseData = await response.json();
                userData = responseData.data || responseData;
                
                console.log('üë§ Datos completos del usuario:', userData);
                
                // Guardar datos del usuario en localStorage para acceso posterior
                localStorage.setItem('user_data', JSON.stringify(userData));
                
                // OBTENER EL ID DEL USUARIO
                userId = await getUserIdAlternative(token);
                if (userId) {
                    document.getElementById('userId').value = userId;
                    console.log(`‚úÖ ID del usuario obtenido: ${userId}`);
                } else {
                    console.error('‚ùå No se pudo obtener el ID del usuario');
                    alert('Error: No se pudo obtener tu informaci√≥n de usuario. Por favor, contacta al soporte.');
                    return;
                }
                
                // Cargar categor√≠as reales desde el backend
                await loadCategories();
                
                // Detectar y configurar el tipo de usuario
                await detectAndConfigureUserType(userData);
                
                // Cargar publicaciones del usuario para verificar l√≠mites
                await loadUserPublications();
                
                // Autocompletar formulario con datos del usuario
                autocompleteFormWithUserData(userData);
                
            } catch (error) {
                console.error('Error cargando datos del usuario:', error);
                alert('Error al cargar los datos del usuario. Por favor, intenta nuevamente.');
            } finally {
                showLoading(false);
            }
        }

        // NUEVA FUNCI√ìN: Cargar categor√≠as reales desde el backend
        async function loadCategories() {
            const token = localStorage.getItem('access_token');
            if (!token) return;

            try {
                console.log('üîÑ Cargando categor√≠as desde el backend...');
                const response = await fetch(`${BACKEND_URL}/api/categorias/`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    // Manejar diferentes formatos de respuesta
                    if (Array.isArray(data)) {
                        categoriasData = data;
                    } else if (data.results && Array.isArray(data.results)) {
                        categoriasData = data.results;
                    } else if (data.data && Array.isArray(data.data)) {
                        categoriasData = data.data;
                    } else {
                        // Intentar encontrar un array en el objeto
                        for (const key in data) {
                            if (Array.isArray(data[key])) {
                                categoriasData = data[key];
                                break;
                            }
                        }
                    }
                    
                    console.log(`‚úÖ Categor√≠as cargadas: ${categoriasData.length} categor√≠as`);
                    console.log('üìã Lista de categor√≠as:', categoriasData.map(c => ({
                        id: c.id_categoria || c.id,
                        nombre: c.nombre_categoria
                    })));
                    
                    // Actualizar el select de categor√≠as con las reales
                    updateCategorySelect();
                    
                } else {
                    console.error('‚ùå Error al cargar categor√≠as:', response.status);
                    // Crear categor√≠as de emergencia si hay error
                    createEmergencyCategories();
                }
            } catch (error) {
                console.error('üí• Error cargando categor√≠as:', error);
                // Crear categor√≠as de emergencia si hay error
                createEmergencyCategories();
            }
        }

        // FUNCI√ìN: Actualizar el select de categor√≠as con las reales
        function updateCategorySelect() {
            const select = document.getElementById('categoria');
            
            // Limpiar opciones
            select.innerHTML = '';
            
            // Agregar opci√≥n por defecto
            const defaultOption = document.createElement('option');
            defaultOption.value = "";
            defaultOption.disabled = true;
            defaultOption.selected = true;
            defaultOption.textContent = "Selecciona una categor√≠a";
            select.appendChild(defaultOption);
            
            // Agregar categor√≠as reales
            categoriasData.forEach(categoria => {
                const categoriaId = categoria.id_categoria || categoria.id;
                const categoriaNombre = categoria.nombre_categoria || categoria.nombre;
                const icono = getCategoryIcon(categoriaNombre);
                
                const option = document.createElement('option');
                option.value = categoriaId;
                option.textContent = `${icono} ${categoriaNombre}`;
                select.appendChild(option);
            });
            
            console.log(`‚úÖ Select de categor√≠as actualizado con ${categoriasData.length} opciones`);
        }

        // FUNCI√ìN: Obtener icono para categor√≠a
        function getCategoryIcon(categoriaNombre) {
            const iconMap = {
                'electricidad': '‚ö°',
                'construcci√≥n': 'üß±',
                'plomer√≠a': 'üîß',
                'carpinter√≠a': 'üõ†Ô∏è',
                'refrigeraci√≥n': '‚ùÑÔ∏è',
                'mec√°nica': 'üöó',
                'turismo': 'üß≥',
                'limpieza': 'üè°',
                'reposter√≠a': 'üéÇ',
                'educaci√≥n': 'üéì',
                'cuidado': 'üë∂',
                'belleza': 'üíá',
                'programaci√≥n': 'üíª',
                'dise√±o': 'üé®',
                'general': 'üîÆ'
            };

            const lowerName = categoriaNombre.toLowerCase();
            for (const [key, icon] of Object.entries(iconMap)) {
                if (lowerName.includes(key)) {
                    return icon;
                }
            }
            return 'üîÆ';
        }

        // FUNCI√ìN: Crear categor√≠as de emergencia si falla la carga
        function createEmergencyCategories() {
            console.log('‚ö†Ô∏è Usando categor√≠as de emergencia');
            categoriasData = [
                { id_categoria: 1, nombre_categoria: 'Electricidad' },
                { id_categoria: 2, nombre_categoria: 'Construcci√≥n' },
                { id_categoria: 3, nombre_categoria: 'Plomer√≠a' },
                { id_categoria: 4, nombre_categoria: 'Carpinter√≠a' },
                { id_categoria: 5, nombre_categoria: 'Refrigeraci√≥n / Aire Acondicionado' },
                { id_categoria: 6, nombre_categoria: 'Mec√°nica automotriz' },
                { id_categoria: 7, nombre_categoria: 'Turismo / Gu√≠as / Hoteler√≠a' },
                { id_categoria: 8, nombre_categoria: 'Limpieza' },
                { id_categoria: 9, nombre_categoria: 'Reposter√≠a' },
                { id_categoria: 10, nombre_categoria: 'Tutor√≠as / Educaci√≥n' },
                { id_categoria: 11, nombre_categoria: 'Cuidado infantil / Adultos mayores' },
                { id_categoria: 12, nombre_categoria: 'Belleza' },
                { id_categoria: 13, nombre_categoria: 'Otros' }
            ];
            updateCategorySelect();
        }

        // FUNCI√ìN: Obtener ID del usuario de forma alternativa
        async function getUserIdAlternative(token) {
            console.log('üîç Buscando ID del usuario de forma alternativa...');
            
            // PRIMER INTENTO: Buscar en localStorage de compras anteriores
            const userPurchases = JSON.parse(localStorage.getItem('user_purchases') || '[]');
            if (userPurchases.length > 0 && userPurchases[0].user_id && userPurchases[0].user_id !== 'unknown') {
                console.log(`‚úÖ ID encontrado en compras anteriores: ${userPurchases[0].user_id}`);
                return userPurchases[0].user_id;
            }
            
            // SEGUNDO INTENTO: Buscar en datos de perfil guardados
            const storedUserData = localStorage.getItem('user_data');
            if (storedUserData) {
                try {
                    const parsedData = JSON.parse(storedUserData);
                    const foundId = getUserIdFromObject(parsedData);
                    if (foundId) {
                        console.log(`‚úÖ ID encontrado en user_data: ${foundId}`);
                        return foundId;
                    }
                } catch (e) {
                    console.error('Error parseando user_data:', e);
                }
            }
            
            // TERCER INTENTO: Hacer una llamada adicional al backend para obtener el ID
            try {
                console.log('üîÑ Intentando obtener ID desde endpoint adicional...');
                const userResponse = await fetch(`${BACKEND_URL}/auth/me/`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (userResponse.ok) {
                    const userInfo = await userResponse.json();
                    const foundId = getUserIdFromObject(userInfo);
                    if (foundId) {
                        console.log(`‚úÖ ID encontrado en /auth/me/: ${foundId}`);
                        return foundId;
                    }
                }
            } catch (error) {
                console.log('‚ùå Endpoint /auth/me/ no disponible');
            }
            
            // CUARTO INTENTO: Intentar con otro endpoint com√∫n
            try {
                console.log('üîÑ Intentando obtener ID desde /api/user/...');
                const userResponse = await fetch(`${BACKEND_URL}/api/user/`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (userResponse.ok) {
                    const userInfo = await userResponse.json();
                    const foundId = getUserIdFromObject(userInfo);
                    if (foundId) {
                        console.log(`‚úÖ ID encontrado en /api/user/: ${foundId}`);
                        return foundId;
                    }
                }
            } catch (error) {
                console.log('‚ùå Endpoint /api/user/ no disponible');
            }
            
            // QUINTO INTENTO: Generar un ID temporal basado en el token
            console.log('üîÑ Generando ID temporal desde token...');
            const tempId = generateTempIdFromToken(token);
            console.log(`‚úÖ ID temporal generado: ${tempId}`);
            return tempId;
        }

        // FUNCI√ìN: Extraer ID de un objeto de usuario
        function getUserIdFromObject(userObject) {
            if (!userObject) return null;
            
            // Buscar en diferentes propiedades posibles
            const possibleIdFields = [
                'id_usuario', 'id', 'user_id', 'usuario_id', 'userId',
                'idUsuario', 'ID', 'Id', 'sub', 'user_sub'
            ];
            
            // Buscar en el objeto principal
            for (let field of possibleIdFields) {
                if (userObject[field] !== undefined && userObject[field] !== null) {
                    console.log(`‚úÖ ID encontrado en campo: ${field} = ${userObject[field]}`);
                    return userObject[field].toString();
                }
            }
            
            // Buscar en data si existe
            if (userObject.data && typeof userObject.data === 'object') {
                for (let field of possibleIdFields) {
                    if (userObject.data[field] !== undefined && userObject.data[field] !== null) {
                        console.log(`‚úÖ ID encontrado en data.${field} = ${userObject.data[field]}`);
                        return userObject.data[field].toString();
                    }
                }
            }
            
            // Buscar en user si existe
            if (userObject.user && typeof userObject.user === 'object') {
                for (let field of possibleIdFields) {
                    if (userObject.user[field] !== undefined && userObject.user[field] !== null) {
                        console.log(`‚úÖ ID encontrado en user.${field} = ${userObject.user[field]}`);
                        return userObject.user[field].toString();
                    }
                }
            }
            
            return null;
        }

        // FUNCI√ìN: Generar ID temporal desde token
        function generateTempIdFromToken(token) {
            // Crear un hash simple del token para usar como ID temporal
            let hash = 0;
            for (let i = 0; i < token.length; i++) {
                const char = token.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convertir a 32-bit integer
            }
            return 'temp_' + Math.abs(hash).toString();
        }

        // FUNCI√ìN: Cargar publicaciones del usuario para verificar l√≠mites
        async function loadUserPublications() {
            const token = localStorage.getItem('access_token');
            if (!token || !userId) return;

            try {
                const response = await fetch(`${BACKEND_URL}/api/publicidades/`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    // Manejar diferentes formatos de respuesta
                    let allPublications = [];
                    if (Array.isArray(data)) {
                        allPublications = data;
                    } else if (data.results && Array.isArray(data.results)) {
                        allPublications = data.results;
                    } else if (data.data && Array.isArray(data.data)) {
                        allPublications = data.data;
                    } else {
                        allPublications = [];
                    }
                    
                    // Filtrar publicaciones activas del usuario actual
                    userPublications = allPublications.filter(publication => {
                        // BUSCAR EN CAMPOS REALES DE LA BASE DE DATOS
                        const publicationUserId = publication.id_usuario_id || publication.id_usuario || publication.usuario_id;
                        const isActive = publication.estado_publicacion === 'activa';
                        return publicationUserId == userId && isActive;
                    });
                    
                    currentPublicationsCount = userPublications.length;
                    console.log(`üìä Publicaciones activas del usuario: ${currentPublicationsCount}`);
                    
                    // Actualizar estado de membres√≠a y l√≠mites
                    updateMembershipStatus();
                    
                } else {
                    console.error('‚ùå Error al cargar publicaciones:', response.status);
                }
            } catch (error) {
                console.error('üí• Error cargando publicaciones:', error);
            }
        }

        // FUNCI√ìN: Actualizar estado de membres√≠a y l√≠mites
        function updateMembershipStatus() {
            const container = document.getElementById('membershipStatusContainer');
            const publishButton = document.getElementById('publishButton');
            
            // Determinar membres√≠a actual
            currentMembership = detectCurrentMembership();
            
            // Normalizar el nombre de la membres√≠a
            const normalizedMembership = normalizeMembershipName(currentMembership);
            const membershipLimit = MEMBERSHIP_LIMITS[normalizedMembership] || 0;
            
            // Obtener valor num√©rico para el backend
            const membershipValue = MEMBERSHIP_VALUES[normalizedMembership] || 1;
            document.getElementById('tipoMembresiaVinculada').value = membershipValue;
            
            console.log(`üé´ Membres√≠a detectada: ${currentMembership} -> Normalizada: ${normalizedMembership}, Valor: ${membershipValue}, L√≠mite: ${membershipLimit}, Publicaciones actuales: ${currentPublicationsCount}`);
            
            let statusHTML = '';
            let canPublish = true;
            let statusClass = 'membership-status success';
            
            if (normalizedMembership === 'visitante') {
                statusHTML = `
                    <div class="membership-status error">
                        <h4>üö´ Membres√≠a Requerida</h4>
                        <p>Necesitas una membres√≠a activa para publicar.</p>
                        <div class="upgrade-prompt">
                            <p>üíé <strong>Actualiza tu membres√≠a</strong> para comenzar a publicar</p>
                            <button class="upgrade-btn" onclick="goToMemberships()">Ver Planes</button>
                        </div>
                    </div>
                `;
                canPublish = false;
                statusClass = 'membership-status error';
                
            } else if (currentPublicationsCount >= membershipLimit) {
                statusHTML = `
                    <div class="membership-status warning">
                        <h4>üìä L√≠mite de Publicaciones Alcanzado</h4>
                        <p>Tu membres√≠a <strong>${normalizedMembership.toUpperCase()}</strong> permite hasta <strong>${membershipLimit} publicaciones activas</strong>.</p>
                        <p class="publications-counter">Publicaciones actuales: <strong>${currentPublicationsCount}/${membershipLimit}</strong></p>
                        <div class="upgrade-prompt">
                            <p>üöÄ <strong>Actualiza tu membres√≠a</strong> para publicar m√°s</p>
                            <button class="upgrade-btn" onclick="goToMemberships()">Mejorar Plan</button>
                        </div>
                    </div>
                `;
                canPublish = false;
                statusClass = 'membership-status warning';
                
            } else {
                const remaining = membershipLimit - currentPublicationsCount;
                statusHTML = `
                    <div class="membership-status success">
                        <h4>‚úÖ Membres√≠a Activa - ${normalizedMembership.toUpperCase()}</h4>
                        <p>Puedes publicar hasta <strong>${membershipLimit} publicaciones activas</strong>.</p>
                        <p class="publications-counter">Publicaciones actuales: <strong>${currentPublicationsCount}/${membershipLimit}</strong> (${remaining} disponibles)</p>
                    </div>
                `;
                canPublish = true;
                statusClass = 'membership-status success';
            }
            
            container.innerHTML = statusHTML;
            
            // Habilitar o deshabilitar bot√≥n de publicaci√≥n
            publishButton.disabled = !canPublish;
            if (!canPublish) {
                publishButton.innerHTML = 'L√≠mite Alcanzado';
                publishButton.style.background = 'linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%)';
            } else {
                // El texto del bot√≥n se establecer√° en updateInterfaceForUserType
                publishButton.style.background = 'linear-gradient(135deg, #2c3e50 0%, #3498db 100%)';
            }
        }

        // FUNCI√ìN: Normalizar nombres de membres√≠a
        function normalizeMembershipName(membershipName) {
            if (!membershipName) return 'visitante';
            
            const lowerName = membershipName.toLowerCase().trim();
            
            // Buscar coincidencias exactas primero
            if (MEMBERSHIP_NAME_MAP[lowerName]) {
                return MEMBERSHIP_NAME_MAP[lowerName];
            }
            
            // Buscar coincidencias parciales
            for (const key in MEMBERSHIP_NAME_MAP) {
                if (lowerName.includes(key)) {
                    return MEMBERSHIP_NAME_MAP[key];
                }
            }
            
            // Coincidencias espec√≠ficas comunes
            if (lowerName.includes('b√°sic') || lowerName.includes('basic')) return 'b√°sica';
            if (lowerName.includes('est√°ndar') || lowerName.includes('estandar') || lowerName.includes('standard')) return 'est√°ndar';
            if (lowerName.includes('premium') || lowerName.includes('premiun')) return 'premium';
            if (lowerName.includes('empresa') || lowerName.includes('enterprise') || lowerName.includes('business')) return 'empresa';
            
            return 'visitante';
        }

        // FUNCI√ìN: Detectar membres√≠a actual del usuario
        function detectCurrentMembership() {
            // Primero verificar en localStorage (actualizado desde la compra)
            const storedMembership = localStorage.getItem('current_membership');
            if (storedMembership) {
                console.log(`‚úÖ Membres√≠a desde localStorage: ${storedMembership}`);
                return storedMembership;
            }
            
            // Luego buscar en los datos del usuario
            if (userData) {
                // Buscar en diferentes propiedades posibles
                const possibleMembershipFields = [
                    'tipo_membresia', 'membresia', 'membership', 'tipoMembresia',
                    'membresia_tipo', 'membership_type', 'plan', 'tipo_plan'
                ];
                
                for (let field of possibleMembershipFields) {
                    if (userData[field] && userData[field] !== null) {
                        console.log(`‚úÖ Membres√≠a encontrada en campo: ${field} = ${userData[field]}`);
                        return userData[field].toString();
                    }
                }
                
                // Buscar en objetos anidados
                if (userData.data && typeof userData.data === 'object') {
                    for (let field of possibleMembershipFields) {
                        if (userData.data[field] && userData.data[field] !== null) {
                            console.log(`‚úÖ Membres√≠a encontrada en data.${field} = ${userData.data[field]}`);
                            return userData.data[field].toString();
                        }
                    }
                }
            }
            
            console.log('‚ùå No se pudo detectar la membres√≠a, usando "visitante" por defecto');
            return 'visitante';
        }

        // FUNCI√ìN: Detectar y configurar el tipo de usuario
        async function detectAndConfigureUserType(userData) {
            console.log('üîç Detectando tipo de usuario...');
            
            // Buscar el tipo de usuario en diferentes propiedades posibles
            const userType = getUserType(userData);
            
            if (userType) {
                console.log(`‚úÖ Tipo de usuario detectado: ${userType}`);
                document.getElementById('userType').value = userType;
                
                // Actualizar la interfaz seg√∫n el tipo de usuario
                updateInterfaceForUserType(userType);
                
                // Mostrar badge con el tipo de usuario
                showUserTypeBadge(userType);
            } else {
                console.log('‚ùì Tipo de usuario no detectado, usando predeterminado: talento_humano');
                document.getElementById('userType').value = 'talento_humano';
                showUserTypeBadge('Talento Humano (predeterminado)');
            }
        }

        // FUNCI√ìN: Obtener el tipo de usuario
        function getUserType(userData) {
            if (!userData) return null;

            // Buscar en diferentes propiedades posibles
            const possibleTypeFields = [
                'tipo_usuario', 'user_type', 'tipoUsuario', 'type', 'rol',
                'role', 'perfil', 'profile', 'tipo', 'userType'
            ];

            for (let field of possibleTypeFields) {
                if (userData[field] !== undefined && userData[field] !== null) {
                    const value = userData[field].toString().toLowerCase();
                    console.log(`‚úÖ Tipo encontrado en campo ${field}: ${value}`);
                    return value;
                }
            }

            // Buscar en objetos anidados
            if (userData.data && typeof userData.data === 'object') {
                for (let field of possibleTypeFields) {
                    if (userData.data[field] !== undefined && userData.data[field] !== null) {
                        const value = userData.data[field].toString().toLowerCase();
                        console.log(`‚úÖ Tipo encontrado en data.${field}: ${value}`);
                        return value;
                    }
                }
            }

            // Buscar en propiedades relacionadas con empresa
            const empresaFields = ['empresa', 'company', 'es_empresa', 'is_company', 'tipo_empresa', 'esEmpresa', 'is_company'];
            for (let field of empresaFields) {
                if (userData[field] !== undefined && userData[field] !== null) {
                    const value = userData[field];
                    if (value === true || value === 'true' || value === 'empresa' || value === 'company' || value === 1 || value === '1') {
                        console.log(`‚úÖ Empresa detectada en campo: ${field} = ${value}`);
                        return 'empresa';
                    }
                }
            }

            // Verificar si el nombre o email sugiere que es empresa
            const nombreCompleto = userData.nombre_completo || userData.nombre || userData.nombres || '';
            const email = userData.email || userData.correo || '';
            
            const empresaKeywords = ['s.a', 's.r.l', 'c.a', 'inc', 'ltda', 'sa', 'srl', 'cia', 'corp'];
            for (const keyword of empresaKeywords) {
                if (nombreCompleto.toLowerCase().includes(keyword) || email.toLowerCase().includes(keyword)) {
                    console.log(`‚úÖ Empresa detectada por keyword "${keyword}" en: ${nombreCompleto || email}`);
                    return 'empresa';
                }
            }

            console.log('‚ÑπÔ∏è Tipo de usuario no espec√≠fico detectado, usando "talento_humano" por defecto');
            return 'talento_humano';
        }

        // FUNCI√ìN: Actualizar interfaz seg√∫n el tipo de usuario
        function updateInterfaceForUserType(userType) {
            const pageTitle = document.getElementById('pageTitle');
            const pageSubtitle = document.getElementById('pageSubtitle');
            const publishButton = document.getElementById('publishButton');
            const nombreLabel = document.querySelector('label[for="nombre"]');
            const descripcionTextarea = document.getElementById('descripcion');
            
            console.log(`üîÑ Actualizando interfaz para tipo de usuario: ${userType}`);
            
            if (userType === 'empresa' || userType === 'company' || userType === 'emprendedor' || userType === 'empresario') {
                // Configurar para empresa
                pageTitle.textContent = 'Publicar oferta de empresa';
                pageSubtitle.textContent = 'Publica oportunidades laborales en tu empresa';
                publishButton.textContent = 'Publicar Oferta';
                
                if (nombreLabel) {
                    nombreLabel.textContent = 'Nombre de la empresa';
                }
                
                if (descripcionTextarea) {
                    descripcionTextarea.placeholder = 'Describe la oferta laboral, requisitos y beneficios...';
                }
                
                // Tambi√©n actualizar el placeholder del input
                const nombreInput = document.getElementById('nombre');
                if (nombreInput) {
                    nombreInput.placeholder = 'Ingresa el nombre de tu empresa';
                }
                
            } else {
                // Configurar para talento humano (predeterminado)
                pageTitle.textContent = 'Publicar talento humano';
                pageSubtitle.textContent = 'Comparte tu talento con nuestra comunidad WORKLY';
                publishButton.textContent = 'Publicar Talento';
                
                if (nombreLabel) {
                    nombreLabel.textContent = 'Nombre';
                }
                
                if (descripcionTextarea) {
                    descripcionTextarea.placeholder = 'Describe tus habilidades, experiencia y servicios que ofreces...';
                }
                
                // Tambi√©n actualizar el placeholder del input
                const nombreInput = document.getElementById('nombre');
                if (nombreInput) {
                    nombreInput.placeholder = 'Ingresa tu Nombre completo';
                }
            }
            
            console.log(`‚úÖ Interfaz actualizada: ${pageTitle.textContent}`);
        }

        // FUNCI√ìN: Mostrar badge con el tipo de usuario
        function showUserTypeBadge(userType) {
            const badge = document.getElementById('userTypeBadge');
            
            let displayText = '';
            let backgroundColor = '';
            
            if (userType === 'empresa' || userType === 'company' || userType === 'emprendedor' || userType === 'empresario') {
                displayText = 'üè¢ Empresa';
                backgroundColor = '#e74c3c';
            } else if (userType === 'talento_humano' || userType === 'talento' || userType === 'personal' || userType === 'profesional') {
                displayText = 'üë§ Talento Humano';
                backgroundColor = '#3498db';
            } else {
                displayText = `üîç ${userType.charAt(0).toUpperCase() + userType.slice(1)}`;
                backgroundColor = '#9b59b6';
            }
            
            badge.textContent = displayText;
            badge.style.backgroundColor = backgroundColor;
            badge.style.display = 'block';
        }

        // FUNCI√ìN: Autocompletar formulario con datos del usuario
        function autocompleteFormWithUserData(user) {
            // Nombre completo - CORREGIDO: Ahora se maneja seg√∫n tipo de usuario
            const userType = document.getElementById('userType').value;
            
            if (userType === 'empresa') {
                // Para empresas, priorizar nombre de empresa
                if (user && user.empresa) {
                    document.getElementById('nombre').value = user.empresa;
                } else if (user && user.nombre_completo) {
                    document.getElementById('nombre').value = user.nombre_completo;
                } else if (user && user.nombre) {
                    document.getElementById('nombre').value = user.nombre;
                }
            } else {
                // Para talento humano, priorizar nombre personal
                if (user && user.nombre_completo) {
                    document.getElementById('nombre').value = user.nombre_completo;
                } else if (user && user.nombre) {
                    document.getElementById('nombre').value = user.nombre;
                } else if (user && user.nombres) {
                    document.getElementById('nombre').value = user.nombres;
                } else if (user && user.empresa) {
                    document.getElementById('nombre').value = user.empresa;
                }
            }

            // Contacto (tel√©fono)
            if (user && user.telefono_contacto) {
                document.getElementById('contacto').value = user.telefono_contacto;
            } else if (user && user.telefono) {
                document.getElementById('contacto').value = user.telefono;
            } else if (user && user.celular) {
                document.getElementById('contacto').value = user.celular;
            } else if (user && user.phone) {
                document.getElementById('contacto').value = user.phone;
            }

            // Ubicaci√≥n (si est√° disponible en el perfil)
            if (user && user.ubicacion) {
                document.getElementById('ubicacion').value = user.ubicacion;
            } else if (user && user.ciudad) {
                document.getElementById('ubicacion').value = user.ciudad;
            } else if (user && user.direccion) {
                document.getElementById('ubicacion').value = user.direccion;
            } else if (user && user.location) {
                document.getElementById('ubicacion').value = user.location;
            }

            // Descripci√≥n del perfil
            if (user && user.descripcion_perfil) {
                document.getElementById('descripcion').value = user.descripcion_perfil;
            } else if (user && user.descripcion) {
                document.getElementById('descripcion').value = user.descripcion;
            } else if (user && user.bio) {
                document.getElementById('descripcion').value = user.bio;
            }

            // Establecer fecha actual como fecha de publicaci√≥n por defecto
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha_publicacion').value = today;
        }

        // FUNCI√ìN CORREGIDA: Enviar formulario con verificaci√≥n de l√≠mites
        async function submitTalentForm() {
            console.log('üéØ Iniciando publicaci√≥n...');
            
            // Verificar l√≠mites antes de proceder
            const normalizedMembership = normalizeMembershipName(currentMembership);
            const membershipLimit = MEMBERSHIP_LIMITS[normalizedMembership] || 0;
            
            if (currentPublicationsCount >= membershipLimit) {
                alert(`‚ùå Has alcanzado el l√≠mite de publicaciones para tu membres√≠a ${normalizedMembership.toUpperCase()} (${membershipLimit} publicaciones).\n\nPor favor, actualiza tu membres√≠a para publicar m√°s.`);
                return;
            }
            
            if (!userId) {
                console.error('‚ùå No hay ID de usuario disponible');
                alert('Error: No se pudo identificar tu usuario. Por favor, recarga la p√°gina.');
                return;
            }

            // Obtener tipo de usuario
            const userType = document.getElementById('userType').value;
            console.log(`üë§ Tipo de usuario para publicaci√≥n: ${userType}`);
            
            // Obtener valor de membres√≠a
            const tipoMembresiaVinculada = document.getElementById('tipoMembresiaVinculada').value;
            console.log(`üé´ Tipo de membres√≠a para publicaci√≥n: ${tipoMembresiaVinculada}`);
            
            // Obtener valores del formulario
            const titulo_publicidad = document.getElementById('titulo_publicidad').value;
            const nombre = document.getElementById('nombre').value;
            const id_categoria = document.getElementById('categoria').value;
            const horario_disponible = document.getElementById('horario_disponible').value;
            const fecha_publicacion = document.getElementById('fecha_publicacion').value;
            const contacto = document.getElementById('contacto').value;
            const ubicacion = document.getElementById('ubicacion').value;
            const descripcion_detallada = document.getElementById('descripcion').value;
            
            console.log('üìã Datos del formulario:', {
                userId, userType, tipoMembresiaVinculada, titulo_publicidad, nombre, id_categoria, 
                horario_disponible, fecha_publicacion, contacto, ubicacion, descripcion_detallada
            });
            
            // Validaciones
            if (!titulo_publicidad || !nombre || !id_categoria || !contacto) {
                alert('‚ùå Por favor completa todos los campos obligatorios');
                return;
            }

            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('üîê No est√°s autenticado. Por favor inicia sesi√≥n.');
                return;
            }

            showLoading(true);

            try {
                // ESTRUCTURA CORREGIDA - USANDO LOS CAMPOS QUE ESPERA EL BACKEND
                const publicationData = {
                    // CAMPOS CORREGIDOS - usando los nombres que espera el backend
                    id_usuario: parseInt(userId), // IMPORTANTE: id_usuario sin _id
                    id_categoria: parseInt(id_categoria), // IMPORTANTE: id_categoria sin _id
                    titulo_publicidad: titulo_publicidad,
                    descripcion_detallada: descripcion_detallada || 'Sin descripci√≥n detallada',
                    tipo_membresia_vinculada: parseInt(tipoMembresiaVinculada), // IMPORTANTE: tipo_membresia_vinculada sin _id
                    estado_publicacion: 'activa',
                    ubicacion: ubicacion || 'No especificada',
                };

                console.log('üì§ Enviando datos CORREGIDOS con campos del backend:', publicationData);
                console.log(`üîç ID de categor√≠a enviado: ${id_categoria} (${parseInt(id_categoria)})`);
                
                // DEBUG: Mostrar informaci√≥n de la categor√≠a seleccionada
                const categoriaSeleccionada = categoriasData.find(cat => {
                    const catId = cat.id_categoria || cat.id;
                    return catId == id_categoria;
                });
                
                if (categoriaSeleccionada) {
                    console.log(`‚úÖ Categor√≠a encontrada: ${categoriaSeleccionada.nombre_categoria} (ID: ${categoriaSeleccionada.id_categoria || categoriaSeleccionada.id})`);
                } else {
                    console.log(`‚ùå Categor√≠a NO encontrada en datos locales para ID: ${id_categoria}`);
                }

                const response = await fetch(`${BACKEND_URL}/api/publicidades/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(publicationData)
                });

                console.log('üì• Respuesta del servidor:', response.status);

                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Publicaci√≥n exitosa:', result);
                    
                    // Actualizar contador de publicaciones
                    currentPublicationsCount++;
                    updateMembershipStatus();
                    
                    let successMessage = '';
                    const categoriaNombre = getCategoryName(id_categoria);
                    
                    if (userType === 'empresa') {
                        successMessage = `üéâ ¬°Oferta de empresa publicada exitosamente!\n\nT√≠tulo: ${titulo_publicidad}\nEmpresa: ${nombre}\nCategor√≠a: ${categoriaNombre}\nContacto: ${contacto}\nUbicaci√≥n: ${ubicacion}`;
                    } else {
                        successMessage = `üéâ ¬°Talento publicado exitosamente!\n\nT√≠tulo: ${titulo_publicidad}\nNombre: ${nombre}\nCategor√≠a: ${categoriaNombre}\nContacto: ${contacto}\nUbicaci√≥n: ${ubicacion}`;
                    }
                    
                    alert(successMessage);
                    
                    // Limpiar solo algunos campos
                    document.getElementById('titulo_publicidad').value = '';
                    document.getElementById('categoria').value = '';
                    document.getElementById('horario_disponible').value = '';
                    document.getElementById('descripcion').value = '';
                    
                } else {
                    const errorData = await response.json();
                    console.error('‚ùå Error del servidor:', errorData);
                    
                    throw new Error(`Error ${response.status}: ${JSON.stringify(errorData)}`);
                }
                
            } catch (error) {
                console.error('üí• Error completo:', error);
                alert('‚ùå Error al publicar: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // FUNCI√ìN: Obtener nombre legible de la categor√≠a
        function getCategoryName(categoryValue) {
            // Buscar en las categor√≠as cargadas
            const categoria = categoriasData.find(cat => {
                const catId = cat.id_categoria || cat.id;
                return catId == categoryValue;
            });
            
            if (categoria) {
                return categoria.nombre_categoria || categoria.nombre || `Categor√≠a #${categoryValue}`;
            }
            
            // Si no se encuentra, usar un mapeo de emergencia
            const categoryMap = {
                '1': 'Electricidad',
                '2': 'Construcci√≥n',
                '3': 'Plomer√≠a',
                '4': 'Carpinter√≠a',
                '5': 'Refrigeraci√≥n / Aire Acondicionado',
                '6': 'Mec√°nica automotriz',
                '7': 'Turismo / Gu√≠as / Hoteler√≠a',
                '8': 'Limpieza',
                '9': 'Reposter√≠a',
                '10': 'Tutor√≠as / Educaci√≥n',
                '11': 'Cuidado infantil / Adultos mayores',
                '12': 'Belleza',
                '13': 'Otros'
            };
            
            return categoryMap[categoryValue] || `Categor√≠a #${categoryValue}`;
        }

        // Funci√≥n para ir a membres√≠as
        function goToMemberships() {
            window.location.href = '/memberships/';
        }

        // Mostrar/ocultar loading
        function showLoading(show) {
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.style.display = show ? 'flex' : 'none';
        }

        // Redirigir al login
        function redirectToLogin() {
            alert('Debes iniciar sesi√≥n para publicar tu talento');
            window.location.href = "/login/";
        }

        // Funci√≥n para volver atr√°s
        function goBack() {
            if (document.referrer) {
                window.history.back();
            } else {
                // Si no hay p√°gina anterior, redirigir a la p√°gina principal
                window.location.href = '/';
            }
        }
    </script>
</body>
</html>
[file content end]